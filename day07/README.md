I'm not at all happy with my solution here. I'm sure there's a nicer way to do it.
